<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): P4::InlineSummary::PerCaller Struct Reference</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('struct_p4_1_1_inline_summary_1_1_per_caller.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="struct_p4_1_1_inline_summary_1_1_per_caller-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">P4::InlineSummary::PerCaller Struct Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Various substitutions that must be applied for each instance.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="inlining_8h_source.html">inlining.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__equal.html">key_equal</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__hash.html">key_hash</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ac209ea19cda03019353a3d3127efba0f" id="r_ac209ea19cda03019353a3d3127efba0f"><td class="memItemLeft" align="right" valign="top">typedef std::pair&lt; const IR::MethodCallStatement *, const IR::PathExpression * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac209ea19cda03019353a3d3127efba0f">InlinedInvocationInfo</a></td></tr>
<tr class="separator:ac209ea19cda03019353a3d3127efba0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1a447ec67084a4e75395cdbb423dccc7" id="r_a1a447ec67084a4e75395cdbb423dccc7"><td class="memItemLeft" align="right" valign="top">const IR::MethodCallStatement *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1a447ec67084a4e75395cdbb423dccc7">uniqueCaller</a> (const IR::Declaration_Instance *instance) const</td></tr>
<tr class="separator:a1a447ec67084a4e75395cdbb423dccc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a8157dbfe1e7522d2f341ed504db67074" id="r_a8157dbfe1e7522d2f341ed504db67074"><td class="memItemLeft" align="right" valign="top"><a id="a8157dbfe1e7522d2f341ed504db67074" name="a8157dbfe1e7522d2f341ed504db67074"></a>
std::map&lt; const IR::MethodCallStatement *, const IR::Declaration_Instance * &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>callToInstance</b></td></tr>
<tr class="memdesc:a8157dbfe1e7522d2f341ed504db67074"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each invocation (key) call the instance that is invoked. <br /></td></tr>
<tr class="separator:a8157dbfe1e7522d2f341ed504db67074"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a389ebb63e1408de17c1a32de48a6cc00" id="r_a389ebb63e1408de17c1a32de48a6cc00"><td class="memItemLeft" align="right" valign="top"><a id="a389ebb63e1408de17c1a32de48a6cc00" name="a389ebb63e1408de17c1a32de48a6cc00"></a>
std::map&lt; const IR::Declaration_Instance *, const IR::IContainer * &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>declToCallee</b></td></tr>
<tr class="memdesc:a389ebb63e1408de17c1a32de48a6cc00"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each instance (key) the container that is intantiated. <br /></td></tr>
<tr class="separator:a389ebb63e1408de17c1a32de48a6cc00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e83f1eb7e5c34ebb51693cb1c88e52e" id="r_a3e83f1eb7e5c34ebb51693cb1c88e52e"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; const <a class="el" href="#ac209ea19cda03019353a3d3127efba0f">InlinedInvocationInfo</a>, const <a class="el" href="struct_p4_1_1_i_r_1_1_i_d.html">IR::ID</a>, <a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__hash.html">key_hash</a>, <a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__equal.html">key_equal</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3e83f1eb7e5c34ebb51693cb1c88e52e">invocationToState</a></td></tr>
<tr class="separator:a3e83f1eb7e5c34ebb51693cb1c88e52e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9265f95d237e30b33bc9cc0f3898b76b" id="r_a9265f95d237e30b33bc9cc0f3898b76b"><td class="memItemLeft" align="right" valign="top"><a id="a9265f95d237e30b33bc9cc0f3898b76b" name="a9265f95d237e30b33bc9cc0f3898b76b"></a>
std::map&lt; const IR::Declaration_Instance *, <a class="el" href="struct_p4_1_1_per_instance_substitutions.html">PerInstanceSubstitutions</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>substitutions</b></td></tr>
<tr class="memdesc:a9265f95d237e30b33bc9cc0f3898b76b"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each instance (key) we must apply a bunch of substitutions. <br /></td></tr>
<tr class="separator:a9265f95d237e30b33bc9cc0f3898b76b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Various substitutions that must be applied for each instance. </p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="ac209ea19cda03019353a3d3127efba0f" name="ac209ea19cda03019353a3d3127efba0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac209ea19cda03019353a3d3127efba0f">&#9670;&#160;</a></span>InlinedInvocationInfo</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt;const IR::MethodCallStatement *, const IR::PathExpression *&gt; <a class="el" href="#ac209ea19cda03019353a3d3127efba0f">P4::InlineSummary::PerCaller::InlinedInvocationInfo</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pair identifying all the invocations of the subparser which can use the same inlined states because the path after returning from the subparser is identical for all such invocations.</p>
<p>Invocations are characterized by:</p><ul>
<li>Pointer to the apply method call statement (comparing apply method call statement ensures that the same instance is invoked and same arguments are passed to the call)</li>
<li>Pointer to the transition statement expression which has to be the name of the state (select expression is not allowed)</li>
</ul>
<p>Additional conditions which need to be met:</p><ul>
<li>there is no other statement between the invocation of the subparser and the transition statement</li>
<li>transition statement has to be the name of the state (select expression is not allowed)</li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>Note that local variables declared in states calling subparser and passed to the subparser as arguments need to be eliminated before Inline pass. Currently this condition is met as passes UniqueNames and MoveDeclarations are called before Inline pass in FrontEnd. Otherwise (if this condition was not met) there could be different variables with the same names passed as arguments to the apply method and additional checks would have to be introduced to avoid optimization in such case.</dd></dl>
<dl class="section see"><dt>See also</dt><dd>field invocationToState </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1a447ec67084a4e75395cdbb423dccc7" name="a1a447ec67084a4e75395cdbb423dccc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a447ec67084a4e75395cdbb423dccc7">&#9670;&#160;</a></span>uniqueCaller()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const IR::MethodCallStatement * P4::InlineSummary::PerCaller::uniqueCaller </td>
          <td>(</td>
          <td class="paramtype">const IR::Declaration_Instance *</td>          <td class="paramname"><span class="paramname"><em>instance</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>nullptr if there isn't exactly one caller, otherwise the single caller of this instance. </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a3e83f1eb7e5c34ebb51693cb1c88e52e" name="a3e83f1eb7e5c34ebb51693cb1c88e52e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e83f1eb7e5c34ebb51693cb1c88e52e">&#9670;&#160;</a></span>invocationToState</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;const <a class="el" href="#ac209ea19cda03019353a3d3127efba0f">InlinedInvocationInfo</a>, const <a class="el" href="struct_p4_1_1_i_r_1_1_i_d.html">IR::ID</a>, <a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__hash.html">key_hash</a>, <a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller_1_1key__equal.html">key_equal</a>&gt; P4::InlineSummary::PerCaller::invocationToState</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>For each distinct invocation of the subparser identified by InlinedInvocationInfo we store the ID of the next caller parser state which is a new state replacing the start state of the callee parser (subparser). Transition to this state is used in case there is another subparser invocation which has the equivalent InlinedInvocationInfo.</p>
<p>Subparser invocations are considered to be equivalent when following conditions are met (which means that the path in the parse graph is the same after returning from subparser call):</p><ul>
<li>apply method call statements of the invocations are equivalent (which means that the same subparser instance is invoked and the same arguments are passed to the apply method)</li>
<li>there is no statement between apply method call statement and transition statement</li>
<li>transition statement is a name of the state (not a select expression)</li>
<li>name of the state in transition statement is the same</li>
</ul>
<p>Example of the optimization</p>
<p>Parser and subparser before Inline pass: </p><div class="fragment"><div class="line">parser Subparser(packet_in packet, inout data_t hdr) {</div>
<div class="line">    state start {</div>
<div class="line">        hdr.f = 8w42;</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">parser ParserImpl(packet_in packet, out headers hdr, inout metadata meta,</div>
<div class="line">                  inout standard_metadata_t standard_metadata) {</div>
<div class="line">    @name(&quot;p&quot;) Subparser() p_0;</div>
<div class="line">    state start {</div>
<div class="line">        transition select(standard_metadata.ingress_port) {</div>
<div class="line">            9w0: p0;</div>
<div class="line">            default: p1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    state p0 {</div>
<div class="line">        p_0.apply(packet, hdr.h1);</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">    state p1 {</div>
<div class="line">        p_0.apply(packet, hdr.h1);</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Parser after Inline pass without optimization: </p><div class="fragment"><div class="line">parser ParserImpl(packet_in packet, out headers hdr, inout metadata meta, inout</div>
<div class="line">standard_metadata_t standard_metadata) { state start { transition</div>
<div class="line">select(standard_metadata.ingress_port) { 9w0: p0; default: p1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    state p0 {</div>
<div class="line">        transition Subparser_start;</div>
<div class="line">    }</div>
<div class="line">    state Subparser_start {</div>
<div class="line">        hdr.h1.f = 8w42;</div>
<div class="line">        transition p0_0;</div>
<div class="line">    }</div>
<div class="line">    state p0_0 {</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">    state p1 {</div>
<div class="line">        transition Subparser_start_0;</div>
<div class="line">    }</div>
<div class="line">    state Subparser_start_0 {</div>
<div class="line">        hdr.h1.f = 8w42;</div>
<div class="line">        transition p1_0;</div>
<div class="line">    }</div>
<div class="line">    state p1_0 {</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Parser after Inline pass with optimization: </p><div class="fragment"><div class="line">parser ParserImpl(packet_in packet, out headers hdr, inout metadata meta, inout</div>
<div class="line">standard_metadata_t standard_metadata) { state start { transition</div>
<div class="line">select(standard_metadata.ingress_port) { 9w0: p0; default: p1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    state p0 {</div>
<div class="line">        transition Subparser_start;</div>
<div class="line">    }</div>
<div class="line">    state Subparser_start {</div>
<div class="line">        hdr.h1.f = 8w42;</div>
<div class="line">        transition p0_0;</div>
<div class="line">    }</div>
<div class="line">    state p0_0 {</div>
<div class="line">        transition accept;</div>
<div class="line">    }</div>
<div class="line">    state p1 {</div>
<div class="line">        transition Subparser_start;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd>This field is used only when the optimization of parser inlining is enabled, otherwise it is not used. The optimization is disabled by default. The optimization can be enabled using command line option &ndash;parser-inline-opt. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_p4.html">P4</a></li><li class="navelem"><a class="el" href="struct_p4_1_1_inline_summary.html">InlineSummary</a></li><li class="navelem"><a class="el" href="struct_p4_1_1_inline_summary_1_1_per_caller.html">PerCaller</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
