<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): P4Smith</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('p4smith.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">P4Smith</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1 empty">
    <ul>
      <li class="level2">
        <a href="#installation-2">Installation</a>
      </li>
      <li class="level2">
        <a href="#extensions">Extensions</a>
        <ul>
          <li class="level3">
            <a href="#corep4-using-the-test-compiler-p4test">core.p4 using the test compiler p4test</a>
          </li>
          <li class="level3">
            <a href="#v1modelp4-and-psap4-on-bmv2">v1model.p4 and psa.p4 on BMv2</a>
          </li>
          <li class="level3">
            <a href="#pnap4-on-the-dpdk-softnic">pna.p4 on the DPDK SoftNIC</a>
          </li>
          <li class="level3">
            <a href="#tnap4-on-tofino-1">tna.p4 on Tofino 1</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#usage-2">Usage</a>
      </li>
      <li class="level2">
        <a href="#further-reading">Further Reading</a>
      </li>
      <li class="level2">
        <a href="#contributing">Contributing</a>
      </li>
      <li class="level2">
        <a href="#license">License</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p><a href="https://github.com/p4lang/p4c/actions/workflows/ci-p4tools.yml"><img src="https://github.com/p4lang/p4c/actions/workflows/ci-p4tools.yml/badge.svg" alt="Status" style="pointer-events: none;" class="inline"/></a></p>
<p>P4Smith is an extensible random P4 program generator in the spirit of <a href="https://en.wikipedia.org/wiki/Csmith">CSmith</a>. P4Smith generates random, but valid P4 programs for various P4 targets, for example the <a href="https://github.com/p4lang/behavioral-model/blob/main/docs/simple_switch.md">v1model.p4</a> architecture on <a href="https://github.com/p4lang/behavioral-model">BMv2</a> or <code>tna.p4</code> running on Tofino 1. P4Smiths generates programs that are valid according to the latest version of the (P4 specification)[<a href="https://p4.org/p4-spec/docs/P4-16-working-spec.html">https://p4.org/p4-spec/docs/P4-16-working-spec.html</a>] or the restrictions of the specific target.</p>
<h2><a class="anchor" id="installation-2"></a>
Installation</h2>
<p>P4Smith depends on the P4Tools framework and is automatically installed with P4Tools. Please follow the instructions listed <a href="https://github.com/p4lang/p4c/tree/main/backends/p4tools#building">here</a> to install P4Smith. The main binary <code>p4smith</code> can be found in the <code>build</code> folder after a successful installation.</p>
<p>P4Smith is available as part of the <a href="https://hub.docker.com/r/p4lang/p4c/">official P4C docker image</a>. On Debian-based systems, it is also possible to install a P4Smith binary by following <a href="https://github.com/p4lang/p4c#installing-packaged-versions-of-p4c">these</a> instructions.</p>
<h2><a class="anchor" id="extensions"></a>
Extensions</h2>
<p>P4Smith extensions are instantiations of a particular combination of P4 architecture and the target that executes the P4 code. For example, the <code>v1model.p4</code> architecture can be executed on the behavioral model. P4Smith extension make use of the core P4Smith framework to generate programs. Several open-source extensions are available.</p>
<h3><a class="anchor" id="corep4-using-the-test-compiler-p4test"></a>
core.p4 using the test compiler p4test</h3>
<p><a href="https://github.com/p4lang/p4c/tree/main/backends/p4tools/modules/smith/targets/generic">targets/generic</a></p>
<p>This random program generator generates random packages and tries to produce all valid P4 code according to the latest P4 specification. Programs should be compiled using <a href="https://github.com/p4lang/p4c/tree/main/backends/p4est">p4test</a>.</p>
<h3><a class="anchor" id="v1modelp4-and-psap4-on-bmv2"></a>
v1model.p4 and psa.p4 on BMv2</h3>
<p><a href="https://github.com/p4lang/p4c/tree/main/backends/p4tools/modules/smith/targets/bmv2">targets/bmv2</a></p>
<p>P4Smith supports generating P4 programs for the <code>v1model</code> and <code>psa</code> architecture on <a href="https://github.com/p4lang/behavioral-model">BMv2</a>.</p>
<h3><a class="anchor" id="pnap4-on-the-dpdk-softnic"></a>
pna.p4 on the DPDK SoftNIC</h3>
<p><a href="https://github.com/p4lang/p4c/tree/main/backends/p4tools/modules/smith/targets/nic">targets/fpga</a></p>
<p>The <a href="https://github.com/p4lang/p4-dpdk-target">DPDK-SoftNIC</a> is a new target implemented using the <a href="https://www.dpdk.org/">Data Plane Development Kit (DPDK)</a>. The SoftNIC can be programmed using the P4 <code>pna.p4</code> architecture.</p>
<h3><a class="anchor" id="tnap4-on-tofino-1"></a>
tna.p4 on Tofino 1</h3>
<p><a href="https://github.com/p4lang/p4c/tree/main/backends/p4tools/modules/smith/targets/tofino">targets/tna</a></p>
<p>P4Smith can also generate programs for the <code>tna</code> architecture on Tofino 1. The programs are intended to be compiled on the proprietary Barefoot Tofino compiler.</p>
<h2><a class="anchor" id="usage-2"></a>
Usage</h2>
<p>To access the possible options for <code>p4smith</code> use <code>p4smith --help</code>. To generate a test for a particular target and P4 architecture, run the following command:</p>
<div class="fragment"><div class="line">./p4smith --target [TARGET] --arch [ARCH] prog.p4</div>
</div><!-- fragment --><p> Where <code>ARCH</code> specifies the P4 architecture (e.g., v1model.p4) and <code>TARGET</code> represents the targeted network device (e.g., BMv2). <code>prog.p4</code> is the name of the generated program.</p>
<h2><a class="anchor" id="further-reading"></a>
Further Reading</h2>
<p>P4Smith was originally titled Bludgeon and part of the Gauntlet compiler testing framework. Section 4 of the <a href="https://arxiv.org/abs/2006.01074">paper</a> provides a high-level overview of the tool.</p>
<p>If you would like to cite this tool please use this citation format: </p><div class="fragment"><div class="line">@inproceedings{ruffy-osdi2020,</div>
<div class="line">author = {Ruffy, Fabian and Wang, Tao and Sivaraman, Anirudh},</div>
<div class="line">title = {Gauntlet: Finding Bugs in Compilers for Programmable Packet Processing},</div>
<div class="line">booktitle = {14th {USENIX} Symposium on Operating Systems Design and Implementation ({OSDI} 20)},</div>
<div class="line">year = {2020},</div>
<div class="line">publisher = {{USENIX} Association},</div>
<div class="line">month = nov,</div>
<div class="line"> abstract = {</div>
<div class="line">  Programmable packet-processing devices such as programmable switches and network interface cards are becoming mainstream. These devices are configured in a domain-specific language such as P4, using a compiler to translate packet-processing programs into instructions for different targets. As networks with programmable devices become widespread, it is critical that these compilers be dependable. This paper considers the problem of finding bugs in compilers for packet processing in the context of P4-16. We introduce domain-specific techniques to induce both abnormal termination of the compiler (crash bugs) and miscompilation (semantic bugs). We apply these techniques to (1) the opensource P4 compiler (P4C) infrastructure, which serves as a common base for different P4 back ends; (2) the P4 back end for the P4 reference software switch; and (3) the P4 back end for the Barefoot Tofino switch. Across the 3 platforms, over 8 months of bug finding, our tool Gauntlet detected 96 new and distinct bugs (62 crash and 34 semantic), which we confirmed with the respective compiler developers. 54 have been fixed (31 crash and 23 semantic); the remaining have been assigned to a developer. Our bug-finding efforts also led to 6 P4 specification changes. We have open sourced Gauntlet at p4gauntlet.github.io and it now runs within P4C’s continuous integration pipeline.}</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="contributing"></a>
Contributing</h2>
<p>Contributions to P4Smith in any form are welcome! Please follow the guidelines listed <a href="https://github.com/p4lang/p4c/blob/main/CONTRIBUTING.md">here</a> to contribute.</p>
<h2><a class="anchor" id="license"></a>
License</h2>
<p>This project is licensed under the Apache License 2.0. See the <a href="https://github.com/p4lang/p4c/blob/main/backends/p4tools/LICENSE">LICENSE</a> file for details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
