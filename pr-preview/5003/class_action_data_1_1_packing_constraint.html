<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): ActionData::PackingConstraint Class Reference</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('class_action_data_1_1_packing_constraint.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="class_action_data_1_1_packing_constraint-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ActionData::PackingConstraint Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="action__format_8h_source.html">action_format.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a807494c18515caf3413659b771fe8c2d" id="r_a807494c18515caf3413659b771fe8c2d"><td class="memItemLeft" align="right" valign="top"><a id="a807494c18515caf3413659b771fe8c2d" name="a807494c18515caf3413659b771fe8c2d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>PackingConstraint</b> (int rg, <a class="el" href="class_p4_1_1safe__vector.html">safe_vector</a>&lt; <a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> &gt; &amp;pc)</td></tr>
<tr class="separator:a807494c18515caf3413659b771fe8c2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa96fd811be673b78b5bd9f0ae7b70fd1" id="r_aa96fd811be673b78b5bd9f0ae7b70fd1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa96fd811be673b78b5bd9f0ae7b70fd1">bit_rotation_position</a> (int bit_width, int init_bit, int final_bit, int init_bit_comp) const</td></tr>
<tr class="separator:aa96fd811be673b78b5bd9f0ae7b70fd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11997f972feec7cd397fadd01c6ec0c8" id="r_a11997f972feec7cd397fadd01c6ec0c8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a11997f972feec7cd397fadd01c6ec0c8">can_rotate</a> (int bit_width, int init_bit, int final_bit) const</td></tr>
<tr class="separator:a11997f972feec7cd397fadd01c6ec0c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad87da38ea8d984ac61acf1824a7e36a4" id="r_ad87da38ea8d984ac61acf1824a7e36a4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad87da38ea8d984ac61acf1824a7e36a4">can_rotate_in_range</a> (<a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;lp, <a class="el" href="struct_p4_1_1_closed_range.html">le_bitrange</a> open_range, int &amp;final_bit) const</td></tr>
<tr class="separator:ad87da38ea8d984ac61acf1824a7e36a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86ff4b9b537b00cca27da38766600531" id="r_a86ff4b9b537b00cca27da38766600531"><td class="memItemLeft" align="right" valign="top"><a id="a86ff4b9b537b00cca27da38766600531" name="a86ff4b9b537b00cca27da38766600531"></a>
<a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a>&#160;</td><td class="memItemRight" valign="bottom"><b>expand</b> (int current_size, int expand_size) const</td></tr>
<tr class="separator:a86ff4b9b537b00cca27da38766600531"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2616f8b8330d6a8f50247c14cc9ba9b0" id="r_a2616f8b8330d6a8f50247c14cc9ba9b0"><td class="memItemLeft" align="right" valign="top"><a id="a2616f8b8330d6a8f50247c14cc9ba9b0" name="a2616f8b8330d6a8f50247c14cc9ba9b0"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>get_granularity</b> () const</td></tr>
<tr class="separator:a2616f8b8330d6a8f50247c14cc9ba9b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb9c46ae63bfb342503973fa3cb8b6f9" id="r_aeb9c46ae63bfb342503973fa3cb8b6f9"><td class="memItemLeft" align="right" valign="top"><a id="aeb9c46ae63bfb342503973fa3cb8b6f9" name="aeb9c46ae63bfb342503973fa3cb8b6f9"></a>
<a class="el" href="class_p4_1_1safe__vector.html">safe_vector</a>&lt; <a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>get_recursive_constraints</b> () const</td></tr>
<tr class="separator:aeb9c46ae63bfb342503973fa3cb8b6f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeeefee1a30ac5d7baa2c1f3cab9c46d0" id="r_aeeefee1a30ac5d7baa2c1f3cab9c46d0"><td class="memItemLeft" align="right" valign="top"><a id="aeeefee1a30ac5d7baa2c1f3cab9c46d0" name="aeeefee1a30ac5d7baa2c1f3cab9c46d0"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>is_rotational</b> () const</td></tr>
<tr class="separator:aeeefee1a30ac5d7baa2c1f3cab9c46d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14d461fc817169ec4c1da05e111acbc4" id="r_a14d461fc817169ec4c1da05e111acbc4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a14d461fc817169ec4c1da05e111acbc4">merge</a> (const <a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> &amp;pc, const <a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;lp, const <a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;pc_lp) const</td></tr>
<tr class="separator:a14d461fc817169ec4c1da05e111acbc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3dafffbd608e3f76f01189bc31c4152" id="r_ab3dafffbd608e3f76f01189bc31c4152"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab3dafffbd608e3f76f01189bc31c4152">rotate</a> (<a class="el" href="struct_action_data_1_1_rotation_info.html">RotationInfo</a> &amp;ri, int init_bit, int final_bit)</td></tr>
<tr class="separator:ab3dafffbd608e3f76f01189bc31c4152"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="friends" name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a57ee5adf02e89238adc7f1da016757b9" id="r_a57ee5adf02e89238adc7f1da016757b9"><td class="memItemLeft" align="right" valign="top"><a id="a57ee5adf02e89238adc7f1da016757b9" name="a57ee5adf02e89238adc7f1da016757b9"></a>
std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator&lt;&lt;</b> (std::ostream &amp;out, const <a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> &amp;pc)</td></tr>
<tr class="separator:a57ee5adf02e89238adc7f1da016757b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Recursive Constraint indicating how data can be moved and rotated in the ActionDataRAMSection. This is due to the multiple levels of action data headed to potentially different sizes of ALU operations. Please read the RamSection comments for further details. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aa96fd811be673b78b5bd9f0ae7b70fd1" name="aa96fd811be673b78b5bd9f0ae7b70fd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa96fd811be673b78b5bd9f0ae7b70fd1">&#9670;&#160;</a></span>bit_rotation_position()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ActionData::PackingConstraint::bit_rotation_position </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>bit_width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>init_bit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>final_bit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>init_bit_comp</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given that a rotation can happen where bit position at init bit will rotate to the bit position at the final bit, determine the location of where init_bit_comp will rotate to. </p>

</div>
</div>
<a id="a11997f972feec7cd397fadd01c6ec0c8" name="a11997f972feec7cd397fadd01c6ec0c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11997f972feec7cd397fadd01c6ec0c8">&#9670;&#160;</a></span>can_rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ActionData::PackingConstraint::can_rotate </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>bit_width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>init_bit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>final_bit</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The function tests if the packing information returns the following:</p><ul>
<li>Can the bit at the init_bit position can be rotated to the final_bit position</li>
</ul>
<p>This is talked about in the comments over the PackingConstraint::rotate section, but the constraints can be rotated recursively. </p>

</div>
</div>
<a id="ad87da38ea8d984ac61acf1824a7e36a4" name="ad87da38ea8d984ac61acf1824a7e36a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad87da38ea8d984ac61acf1824a7e36a4">&#9670;&#160;</a></span>can_rotate_in_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ActionData::PackingConstraint::can_rotate_in_range </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>lp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_p4_1_1_closed_range.html">le_bitrange</a></td>          <td class="paramname"><span class="paramname"><em>open_range</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;</td>          <td class="paramname"><span class="paramname"><em>final_bit</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This check verifies that the data (summarized in the LocalPacking) can be rotated into the bit data into the open_range. The function also calculates the position of the final bit, in which the first set bit in the lp.bit_in_use can be rotated into for the rotate function.</p>
<p>The test is done as a two-parter.</p>
<ol type="1">
<li>Can the RAM section be rotated to constraint where the first bit of the open_range (called under_rotate).</li>
<li>If it cannot be rotated to this section, then rotate one more section and try again, (called over_rotate).</li>
</ol>
<p>The goal of this is to keep data as close as possible to the lsb of the RAM section.</p>
<p>This works well with an example:</p>
<p>Say again, you have a 16 bit, byte-by-byte rotational constraints, with data packed from bits 0:3. Let's now provide some potential ranges.</p>
<p>Test for open_range 4:11:</p><ul>
<li>In a byte by byte rotation, the initial byte rotation is 0. We then recurse to the bit granularity and find that we can rotate the first byte, bit by bit, so that the bits end up a bits 4:7</li>
</ul>
<p>Test for open_range 5:11:</p><ul>
<li>In this case, the under_rotation will fail, as only 3 bits are available in that byte but after a rotation to the next byte, then this will fit.</li>
</ul>
<p>This is all based on the idea that the algorithm is trying to pack data as close to the lsb. </p>

</div>
</div>
<a id="a14d461fc817169ec4c1da05e111acbc4" name="a14d461fc817169ec4c1da05e111acbc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14d461fc817169ec4c1da05e111acbc4">&#9670;&#160;</a></span>merge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> ActionData::PackingConstraint::merge </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>lp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_action_data_1_1_local_packing.html">LocalPacking</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pc_lp</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Essentially to merge constraints:</p>
<p>When merging a bit-by-bit rotational section with a non bit-by-bit rotational section, the RAM section is not bit-by-bit rotational.</p>
<p>When merging two bit-by-bit rotational RAM sections, the merged RAM section is also bit-by-bit rotational</p>
<p>When merging two bit-by-bit rotational RAM sections that are different sizes:</p><ol type="1">
<li>The merged section rotational_granularity is the size of the smaller slot size</li>
<li>Any recursive constraint containing data from the larger section is not bit-by-bit rotational. Thus if a recursive constraint contains data from the smaller section, it is not bit-by-bit rotational if that section also contains data from the larger section.</li>
</ol>
<p>This is displayed in the gtests for CrossSizeMerge as well as the Google Doc notes. </p>
<blockquote class="doxtable">
<p>&zwj;Recursive constraints should only be merged, if the data was to merge </p>
</blockquote>

</div>
</div>
<a id="ab3dafffbd608e3f76f01189bc31c4152" name="ab3dafffbd608e3f76f01189bc31c4152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3dafffbd608e3f76f01189bc31c4152">&#9670;&#160;</a></span>rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ActionData::PackingConstraint::rotate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_action_data_1_1_rotation_info.html">RotationInfo</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>ri</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>init_bit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>final_bit</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The rotation function both rotates the constraints as well as the data bit-by-bit so that the data bit at the init_bit position can will be at the final_bit position. This function recurses down the constraint levels so that the only the relevant portion to rotate will have been rotated.</p>
<p>Let's set up the following scenario:</p>
<p>16 bit data, that is byte by byte rotational, and each byte is bit by bit rotational The data is arg1[3:0] at RAM bit 3:0 and arg2[3:0] at RAM bit 11:8:</p>
<p>The init_bit and final_bit are 0, 12. After the rotation: arg2[3:0] will be at RAM bit [3:0] arg1[3:0] will be at RAM bit [15:12]</p>
<p>This is because both bytes are rotated, but only the byte at the final bit is rotated. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_action_data.html">ActionData</a></li><li class="navelem"><a class="el" href="class_action_data_1_1_packing_constraint.html">PackingConstraint</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
