<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): Behavioral Model Backend</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('behavioral_model_backend.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Behavioral Model Backend</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#dependencies-1">Dependencies</a>
  </li>
  <li class="level1">
    <a href="#unsupported-p4_16-language-features">Unsupported P4_16 language features</a>
  </li>
  <li class="level1">
    <a href="#bmv2-pna_nic-backend">BMv2 &quot;pna_nic&quot; Backend</a>
  </li>
  <li class="level1">
    <a href="#portable_common">portable_common</a>
  </li>
</ul>
</div>
<div class="textblock"><p>This is a back-end which generates code for the <a href="https://github.com/p4lang/behavioral-model.git">Behavioral Model version 2 (BMv2)</a>.</p>
<p>It can accept either P4_14 programs, or P4_16 programs written for the <code>v1model.p4</code> switch model.</p>
<h1><a class="anchor" id="dependencies-1"></a>
Dependencies</h1>
<p>To run and test this back-end you need some additional tools:</p>
<ul>
<li>the BMv2 behavioral model itself. Installation instructions are available <a href="https://github.com/p4lang/behavioral-model#installing-bmv2">here</a>. You may need to update your dynamic libraries after installing bmv2: <code>sudo ldconfig</code></li>
<li>the Python scapy library <code>sudo pip3 install scapy</code></li>
</ul>
<h1><a class="anchor" id="unsupported-p4_16-language-features"></a>
Unsupported P4_16 language features</h1>
<p>Here are some unsupported features we are aware of. We will update this list as more features get supported in the bmv2 compiler backend and as we discover more issues.</p>
<ul>
<li>explicit transition to reject in parse state</li>
<li>compound action parameters (can only be <code>bit&lt;&gt;</code> or <code>int&lt;&gt;</code>)</li>
<li>functions or methods with a compound return type <div class="fragment"><div class="line">struct s_t {</div>
<div class="line">    bit&lt;8&gt; f0;</div>
<div class="line">    bit&lt;8&gt; f1;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">extern s_t my_extern_function();</div>
<div class="line"> </div>
<div class="line">controlc c() {</div>
<div class="line">    apply { s_t s1 = my_extern_function(); }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>user-defined extern types / methods which are not defined in <code>v1model.p4</code></li>
<li>stacks of header unions</li>
</ul>
<h1><a class="anchor" id="bmv2-pna_nic-backend"></a>
BMv2 "pna_nic" Backend</h1>
<p>The <a href="https://github.com/p4lang/p4c/tree/main/backends/bmv2/pna_nic"><code>backends/bmv2/pna_nic</code> directory</a> contains components specific to the BMv2's PNA NIC (Portable NIC Architecture) backend in the P4C compiler. The files in this folder depend on each other, on the files in the <code>bmv2/common</code> and <code>portable_common</code> directories. Most of the classes are inherited from the classes in the <code>portable_common</code> directory.</p>
<p>Output Binary: <code>p4c-bm2-pna</code></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File(s)   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>pnaProgramStructure.h</code>, <code>pnaProgramStructure.cpp</code>   </td><td class="markdownTableBodyNone">Defines and implements the program structure (metadata, parsers, controls, and deparsers) and parsing logic specific to the BMv2's PNA NIC backend.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>midend.h</code>, <code>midend.cpp</code>   </td><td class="markdownTableBodyNone">Defines the mid-end processing of the PNA NIC compiler. Performs various transformations and optimizations on the program's Intermediate Representation (IR).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>options.h</code>, <code>options.cpp</code>   </td><td class="markdownTableBodyNone">Manages the command-line options for the PNA NIC compiler.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>pnaNic.h</code>, <code>pnaNic.cpp</code>   </td><td class="markdownTableBodyNone">Provides backend implementation to the BMv2's PNA NIC compiler.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>main.cpp</code>   </td><td class="markdownTableBodyNone">Sets up compilation environment, integrates various components, and executes the PNA NIC compiler.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>version.h.cmake</code>   </td><td class="markdownTableBodyNone">Defines macros containing version information for the PNA NIC compiler.   </td></tr>
</table>
<h1><a class="anchor" id="portable_common"></a>
portable_common</h1>
<p>The <a href="https://github.com/p4lang/p4c/tree/main/backends/bmv2/portable_common"><code>portable_common</code> directory</a> contains reusable components common to both the <code>psa_switch</code> and <code>pna_nic</code> backends.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>File Name</b>   </th><th class="markdownTableHeadNone"><b>Description</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>midend.h, midend.cpp</b>   </td><td class="markdownTableBodyNone">Defines the common mid-end processing of both the <code>psa_switch</code> and <code>pna_nic</code> backends.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>options.h, options.cpp</b>   </td><td class="markdownTableBodyNone">Defines the common command-line options of both the <code>psa_switch</code> and <code>pna_nic</code> backends.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>portable.h, portable.cpp</b>   </td><td class="markdownTableBodyNone">Defines common functionalities that generate representations of P4 programs.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>portableProgramStructure.h, portableProgramStructure.cpp</b>   </td><td class="markdownTableBodyNone">Defines and implements the common program structure of both the <code>psa_switch</code> and <code>pna_nic</code> backends. _These files are located in the <code>backends/common</code> directory.   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
