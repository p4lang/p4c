<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): DynamicDependencyMetrics Class Reference</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<!-- Add interactive TOC -->
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-interactive-toc.js" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('class_dynamic_dependency_metrics.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_dynamic_dependency_metrics-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">DynamicDependencyMetrics Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af6f24861a93a43e23f97b51e56faf012" id="r_af6f24861a93a43e23f97b51e56faf012"><td class="memItemLeft" align="right" valign="top"><a id="af6f24861a93a43e23f97b51e56faf012" name="af6f24861a93a43e23f97b51e56faf012"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>DynamicDependencyMetrics</b> (const <a class="el" href="class_calculate_next_table_prop.html">CalculateNextTableProp</a> &amp;n, const <a class="el" href="class_control_pathways_to_table.html">ControlPathwaysToTable</a> &amp;cp, const <a class="el" href="struct_dependency_graph.html">DependencyGraph</a> &amp;d)</td></tr>
<tr class="separator:af6f24861a93a43e23f97b51e56faf012"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae25bb0da194fd21c9f8c1f587aefa68b" id="r_ae25bb0da194fd21c9f8c1f587aefa68b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae25bb0da194fd21c9f8c1f587aefa68b">average_cds_chain_length</a> (const IR::MAU::Table *tbl) const</td></tr>
<tr class="separator:ae25bb0da194fd21c9f8c1f587aefa68b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a376b96df93b26c1dfde0c04b176bf8bd" id="r_a376b96df93b26c1dfde0c04b176bf8bd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a376b96df93b26c1dfde0c04b176bf8bd">can_place_cds_in_stage</a> (const IR::MAU::Table *tbl, <a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::MAU::Table * &gt; &amp;already_placed_in_table) const</td></tr>
<tr class="separator:a376b96df93b26c1dfde0c04b176bf8bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72194796605eac795abc5ac9c1b17d8d" id="r_a72194796605eac795abc5ac9c1b17d8d"><td class="memItemLeft" align="right" valign="top">std::pair&lt; int, int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a72194796605eac795abc5ac9c1b17d8d">get_downward_prop_score</a> (const IR::MAU::Table *a, const IR::MAU::Table *b) const</td></tr>
<tr class="separator:a72194796605eac795abc5ac9c1b17d8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a240ce2a68949c82e48b7a83e60acc6ac" id="r_a240ce2a68949c82e48b7a83e60acc6ac"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a240ce2a68949c82e48b7a83e60acc6ac">placeable_cds_count</a> (const IR::MAU::Table *tbl, <a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::MAU::Table * &gt; &amp;already_placed_in_stage) const</td></tr>
<tr class="separator:a240ce2a68949c82e48b7a83e60acc6ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441a3c45b87f62b3dda1991537701580" id="r_a441a3c45b87f62b3dda1991537701580"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a441a3c45b87f62b3dda1991537701580">score_on_seq</a> (const IR::MAU::TableSeq *seq, const IR::MAU::Table *tbl, int &amp;max_dep_impact, char type) const</td></tr>
<tr class="separator:a441a3c45b87f62b3dda1991537701580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61139846099dec972efa5597f8b611a8" id="r_a61139846099dec972efa5597f8b611a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a61139846099dec972efa5597f8b611a8">total_deps_of_dom_frontier</a> (const IR::MAU::Table *a) const</td></tr>
<tr class="separator:a61139846099dec972efa5597f8b611a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147a1beb55d7ea8aae7b6ebc2e1c6204" id="r_a147a1beb55d7ea8aae7b6ebc2e1c6204"><td class="memItemLeft" align="right" valign="top"><a id="a147a1beb55d7ea8aae7b6ebc2e1c6204" name="a147a1beb55d7ea8aae7b6ebc2e1c6204"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>update_placed_tables</b> (std::function&lt; bool(const IR::MAU::Table *)&gt; pt)</td></tr>
<tr class="separator:a147a1beb55d7ea8aae7b6ebc2e1c6204"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae25bb0da194fd21c9f8c1f587aefa68b" name="ae25bb0da194fd21c9f8c1f587aefa68b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae25bb0da194fd21c9f8c1f587aefa68b">&#9670;&#160;</a></span>average_cds_chain_length()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double DynamicDependencyMetrics::average_cds_chain_length </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>tbl</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the average chain length of every table in the control dominating set </p>

</div>
</div>
<a id="a376b96df93b26c1dfde0c04b176bf8bd" name="a376b96df93b26c1dfde0c04b176bf8bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a376b96df93b26c1dfde0c04b176bf8bd">&#9670;&#160;</a></span>can_place_cds_in_stage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DynamicDependencyMetrics::can_place_cds_in_stage </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::MAU::Table * &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>already_placed_in_stage</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given what has already been placed within a stage, return if the table, and any table that the next table has to be propagated into can be placed in this stage due to dependencies. Relevant for Tofino. </p>

</div>
</div>
<a id="a72194796605eac795abc5ac9c1b17d8d" name="a72194796605eac795abc5ac9c1b17d8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72194796605eac795abc5ac9c1b17d8d">&#9670;&#160;</a></span>get_downward_prop_score()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; int, int &gt; DynamicDependencyMetrics::get_downward_prop_score </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>a</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>b</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>So in Tofino specifically, this is to help place tables in sequences due to the other tables. Let's look at the following example:</p>
<p>apply() { t1.apply(); if (t2.apply().hit) { t3.apply(); } t4.apply(); }</p>
<p>The sequence nodes in this case will be:</p>
<p>[ t1, t2, t4 ] | | $hit | V [ t3 ]</p>
<p>Now I'm going to assign dependency chains, though let's say that these have no direct dependencies with each other: </p><pre class="fragment">t1 - 7
t2 - 9
t3 - 0
t4 - 8
</pre><p>When we place table t2, t3 must be placed before any other tables hit. However, t3 will not be favored directly. But in this case, because t4 is waiting, the metrics for t3 must see this function.</p>
<p>The purpose of this function is to compare two tables, specifically the different tables that they affect until they get placed, and get the max dependency chain from all tables that this particular table is waiting on. This is called a downward propagation score as we are propagating dependency information down from a control flow dominator.</p>
<p>TODO: Eventually instead of the top TableSequence, all table sequences leading up to that table should be analyzedj</p>
<p>This constraint is completely voided in Tofino2 </p>

</div>
</div>
<a id="a240ce2a68949c82e48b7a83e60acc6ac" name="a240ce2a68949c82e48b7a83e60acc6ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a240ce2a68949c82e48b7a83e60acc6ac">&#9670;&#160;</a></span>placeable_cds_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DynamicDependencyMetrics::placeable_cds_count </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::MAU::Table * &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>already_placed_in_stage</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given what has already been placed within a stage, return the number of tables that can be placed of this table next table dominating set </p>

</div>
</div>
<a id="a441a3c45b87f62b3dda1991537701580" name="a441a3c45b87f62b3dda1991537701580"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a441a3c45b87f62b3dda1991537701580">&#9670;&#160;</a></span>score_on_seq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DynamicDependencyMetrics::score_on_seq </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::TableSeq *</td>          <td class="paramname"><span class="paramname"><em>seq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>tbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;</td>          <td class="paramname"><span class="paramname"><em>max_dep_impact</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char</td>          <td class="paramname"><span class="paramname"><em>type</em></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copyright (C) 2024 Intel Corporation</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p>SPDX-License-Identifier: Apache-2.0 </p>

</div>
</div>
<a id="a61139846099dec972efa5597f8b611a8" name="a61139846099dec972efa5597f8b611a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61139846099dec972efa5597f8b611a8">&#9670;&#160;</a></span>total_deps_of_dom_frontier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DynamicDependencyMetrics::total_deps_of_dom_frontier </td>
          <td>(</td>
          <td class="paramtype">const IR::MAU::Table *</td>          <td class="paramname"><span class="paramname"><em>a</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Based on how many dependencies are within the control dominating set. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_dynamic_dependency_metrics.html">DynamicDependencyMetrics</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
