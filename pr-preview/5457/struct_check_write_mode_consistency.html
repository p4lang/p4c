<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): CheckWriteModeConsistency Struct Reference</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<!-- Add interactive TOC -->
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-interactive-toc.js" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('struct_check_write_mode_consistency.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="struct_check_write_mode_consistency-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CheckWriteModeConsistency Struct Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="check__parser__multi__write_8h_source.html">check_parser_multi_write.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CheckWriteModeConsistency:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="struct_check_write_mode_consistency__inherit__graph.svg" width="223" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a35a496a68d1bd9431b9f778ac7610266" id="r_a35a496a68d1bd9431b9f778ac7610266"><td class="memItemLeft" align="right" valign="top"><a id="a35a496a68d1bd9431b9f778ac7610266" name="a35a496a68d1bd9431b9f778ac7610266"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>CheckWriteModeConsistency</b> (const <a class="el" href="class_phv_info.html">PhvInfo</a> &amp;p, const <a class="el" href="class_map_field_to_parser_states.html">MapFieldToParserStates</a> &amp;fs, const <a class="el" href="group__parde.html">CollectParserInfo</a> &amp;pi)</td></tr>
<tr class="separator:a35a496a68d1bd9431b9f778ac7610266"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1883cacd633e9a32a4d7a890f41695fd" id="r_a1883cacd633e9a32a4d7a890f41695fd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1883cacd633e9a32a4d7a890f41695fd">check_compatability</a> (const <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a> &amp;slice_a, const <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a> &amp;slice_b)</td></tr>
<tr class="separator:a1883cacd633e9a32a4d7a890f41695fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a1e19fcfd9f53b0632857b5610453ff54" id="r_a1e19fcfd9f53b0632857b5610453ff54"><td class="memItemLeft" align="right" valign="top"><a id="a1e19fcfd9f53b0632857b5610453ff54" name="a1e19fcfd9f53b0632857b5610453ff54"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>check</b> (const std::vector&lt; const IR::BFN::Extract * &gt; extracts) const</td></tr>
<tr class="memdesc:a1e19fcfd9f53b0632857b5610453ff54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that the write modes of all extracts are consistent. <br /></td></tr>
<tr class="separator:a1e19fcfd9f53b0632857b5610453ff54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a642300fab56b5f30246780b8f61b139e" id="r_a642300fab56b5f30246780b8f61b139e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a642300fab56b5f30246780b8f61b139e">check_and_adjust</a> (const std::vector&lt; const IR::BFN::Extract * &gt; extracts)</td></tr>
<tr class="memdesc:a642300fab56b5f30246780b8f61b139e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check and adjust the write modes of all extracts to be consistent.  <br /></td></tr>
<tr class="separator:a642300fab56b5f30246780b8f61b139e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fba7d1b3f3446654847364591fab14f" id="r_a7fba7d1b3f3446654847364591fab14f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7fba7d1b3f3446654847364591fab14f">check_post_alloc</a> ()</td></tr>
<tr class="memdesc:a7fba7d1b3f3446654847364591fab14f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify/unify parser write mode consistency post PHV allocation.  <br /></td></tr>
<tr class="separator:a7fba7d1b3f3446654847364591fab14f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c8335b7adf59fef52fc20afc904c9eb" id="r_a5c8335b7adf59fef52fc20afc904c9eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5c8335b7adf59fef52fc20afc904c9eb">check_pre_alloc</a> (const <a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::BFN::ParserPrimitive * &gt; &amp;state_writes)</td></tr>
<tr class="separator:a5c8335b7adf59fef52fc20afc904c9eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acde2f10e0321ce08bfd12b787b8f857c" id="r_acde2f10e0321ce08bfd12b787b8f857c"><td class="memItemLeft" align="right" valign="top"><a id="acde2f10e0321ce08bfd12b787b8f857c" name="acde2f10e0321ce08bfd12b787b8f857c"></a>
profile_t&#160;</td><td class="memItemRight" valign="bottom"><b>init_apply</b> (const IR::Node *root) override</td></tr>
<tr class="separator:acde2f10e0321ce08bfd12b787b8f857c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0be16bfd9fde715b6987e9b5e26a712e" id="r_a0be16bfd9fde715b6987e9b5e26a712e"><td class="memItemLeft" align="right" valign="top"><a id="a0be16bfd9fde715b6987e9b5e26a712e" name="a0be16bfd9fde715b6987e9b5e26a712e"></a>
IR::Node *&#160;</td><td class="memItemRight" valign="bottom"><b>preorder</b> (IR::BFN::Extract *extract) override</td></tr>
<tr class="separator:a0be16bfd9fde715b6987e9b5e26a712e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b09f942db5a76f97861844d8707b861" id="r_a8b09f942db5a76f97861844d8707b861"><td class="memItemLeft" align="right" valign="top"><a id="a8b09f942db5a76f97861844d8707b861" name="a8b09f942db5a76f97861844d8707b861"></a>
IR::Node *&#160;</td><td class="memItemRight" valign="bottom"><b>preorder</b> (IR::BFN::ParserChecksumWritePrimitive *pcw) override</td></tr>
<tr class="separator:a8b09f942db5a76f97861844d8707b861"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd5c196718ee0e0ba71bb39e7165c962" id="r_afd5c196718ee0e0ba71bb39e7165c962"><td class="memTemplParams" colspan="2"><a id="afd5c196718ee0e0ba71bb39e7165c962" name="afd5c196718ee0e0ba71bb39e7165c962"></a>
template&lt;typename T&gt; </td></tr>
<tr class="memitem:afd5c196718ee0e0ba71bb39e7165c962"><td class="memTemplItemLeft" align="right" valign="top">IR::Node *&#160;</td><td class="memTemplItemRight" valign="bottom"><b>set_write_mode</b> (T *write)</td></tr>
<tr class="separator:afd5c196718ee0e0ba71bb39e7165c962"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:af90655c220de780b49014ffe320de309" id="r_af90655c220de780b49014ffe320de309"><td class="memItemLeft" align="right" valign="top"><a id="af90655c220de780b49014ffe320de309" name="af90655c220de780b49014ffe320de309"></a>
std::map&lt; std::pair&lt; <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a>, <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a> &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>compatability</b></td></tr>
<tr class="separator:af90655c220de780b49014ffe320de309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58e40e2e662ca9eea1369176e91d336f" id="r_a58e40e2e662ca9eea1369176e91d336f"><td class="memItemLeft" align="right" valign="top"><a id="a58e40e2e662ca9eea1369176e91d336f" name="a58e40e2e662ca9eea1369176e91d336f"></a>
std::map&lt; const IR::BFN::ParserPrimitive *, IR::BFN::ParserWriteMode &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>extract_to_write_mode</b></td></tr>
<tr class="separator:a58e40e2e662ca9eea1369176e91d336f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1925bf6b37f2e878c1ca65e0a48833e" id="r_ac1925bf6b37f2e878c1ca65e0a48833e"><td class="memItemLeft" align="right" valign="top"><a id="ac1925bf6b37f2e878c1ca65e0a48833e" name="ac1925bf6b37f2e878c1ca65e0a48833e"></a>
const <a class="el" href="class_map_field_to_parser_states.html">MapFieldToParserStates</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>field_to_states</b></td></tr>
<tr class="separator:ac1925bf6b37f2e878c1ca65e0a48833e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c203f279748d2a8b544164305c6c018" id="r_a5c203f279748d2a8b544164305c6c018"><td class="memItemLeft" align="right" valign="top"><a id="a5c203f279748d2a8b544164305c6c018" name="a5c203f279748d2a8b544164305c6c018"></a>
const <a class="el" href="class_phv_info.html">PhvInfo</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>phv</b></td></tr>
<tr class="separator:a5c203f279748d2a8b544164305c6c018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc2e66b8a28e095db530d00695f2ebc2" id="r_afc2e66b8a28e095db530d00695f2ebc2"><td class="memItemLeft" align="right" valign="top"><a id="afc2e66b8a28e095db530d00695f2ebc2" name="afc2e66b8a28e095db530d00695f2ebc2"></a>
const <a class="el" href="struct_parser_query.html">ParserQuery</a>&#160;</td><td class="memItemRight" valign="bottom"><b>pq</b></td></tr>
<tr class="separator:afc2e66b8a28e095db530d00695f2ebc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Check if fields that share the same byte on the wire have conflicting parser write semantics. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a642300fab56b5f30246780b8f61b139e" name="a642300fab56b5f30246780b8f61b139e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a642300fab56b5f30246780b8f61b139e">&#9670;&#160;</a></span>check_and_adjust()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CheckWriteModeConsistency::check_and_adjust </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const IR::BFN::Extract * &gt;</td>          <td class="paramname"><span class="paramname"><em>extracts</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check and adjust the write modes of all extracts to be consistent. </p>
<p>Checks whether the write modes of all extracts are consistent. If not, record the adjustments necessary to make them consistent, or produce an error if they can't be made consistent. </p>

</div>
</div>
<a id="a1883cacd633e9a32a4d7a890f41695fd" name="a1883cacd633e9a32a4d7a890f41695fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1883cacd633e9a32a4d7a890f41695fd">&#9670;&#160;</a></span>check_compatability()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckWriteModeConsistency::check_compatability </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slice_a</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_p_h_v_1_1_field_slice.html">PHV::FieldSlice</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>slice_b</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if the extracts for two slices can be made compatible </p>

</div>
</div>
<a id="a7fba7d1b3f3446654847364591fab14f" name="a7fba7d1b3f3446654847364591fab14f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fba7d1b3f3446654847364591fab14f">&#9670;&#160;</a></span>check_post_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CheckWriteModeConsistency::check_post_alloc </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify/unify parser write mode consistency post PHV allocation. </p>
<p>Verify that the parser write modes are consistent across fields. If not, then attempt to unify the write modes. </p>

</div>
</div>
<a id="a5c8335b7adf59fef52fc20afc904c9eb" name="a5c8335b7adf59fef52fc20afc904c9eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c8335b7adf59fef52fc20afc904c9eb">&#9670;&#160;</a></span>check_pre_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CheckWriteModeConsistency::check_pre_alloc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_p4_1_1ordered__set.html">ordered_set</a>&lt; const IR::BFN::ParserPrimitive * &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>state_writes</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel protected">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Find all extracts that stard/end in mid byte and add them to a map by the partial byte they create. Ideally, we would check together only fields that actually lead to the same PHV. But this would require doing this analysis only after fields are sliced and PHV allocated. That currently cannot be done as the PHV allocation uses write modes as input. A proper solution might be to integrate this check/modification of write modes to PHV allocation.</p>
<p>Meanwhile, we approximate by looking for generations of extracted bits &ndash; we go over the extracts in the order they appear in the state and every time we encounter bit that is not higher than the last already extracted, we start a new generation of extracts. Then we only look for conflicts within the same generation. This should resolve code like pkt.extract(hdrs.a) meta.x = pkt.hdr.a.x that does actually generate two extracts of <code>x</code> to different fields. NOTE: the ranges coming from one P4 extract may not be consecutive due to dead-extract elimination. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_check_write_mode_consistency.html">CheckWriteModeConsistency</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
