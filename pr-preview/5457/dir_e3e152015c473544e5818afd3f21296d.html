<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P4 Compiler Documentation (P4C): bf-asm Directory Reference</title>
<link rel="icon" href="p4-fav.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--  Add link to paragraphs   -->
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<!-- Add copy button to code fragments  -->
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add dark mode toggle -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<!-- Add interactive TOC -->
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-interactive-toc.js" rel="stylesheet" type="text/css"/>
<link href="cards.css" rel="stylesheet" type="text/css"/>
<link href="flow.css" rel="stylesheet" type="text/css"/>
<link href="p4c_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="p4-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">P4C
   </div>
   <div id="projectbrief">The P4 Compiler</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_e3e152015c473544e5818afd3f21296d.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">bf-asm Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Directory dependency graph for bf-asm:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="dir_e3e152015c473544e5818afd3f21296d_dep.svg" width="462" height="126"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_6c3e121c76b20d60d0269089ef4706e8.html">gtest</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_2583094a385d131f8c302edd2fb77459.html">jbay</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_66cee497bf2de90581bd4b6ec071ae09.html">tofino</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_2417739ea001a185e7209f2a3797be42.html">walle</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="action__bus_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>action_bus.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="alias__array_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>alias_array.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="bf-asm_2alloc_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>alloc.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="asm-types_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>asm-types.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="bfas_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>bfas.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="binary__output_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>binary_output.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="bson_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>bson.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="checked__array_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>checked_array.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tofino_2bf-asm_2constants_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>constants.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="data__switchbox_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>data_switchbox.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tofino_2bf-asm_2deparser_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>deparser.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="depositfield_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>depositfield.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="disasm_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>disasm.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="error__mode_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>error_mode.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="escape_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>escape.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="fdstream_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fdstream.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="hash__dist_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>hash_dist.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="hashexpr_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>hashexpr.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="bf-asm_2input__xbar_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>input_xbar.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="instruction_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>instruction.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="backends_2tofino_2bf-asm_2json_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>json.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="backends_2tofino_2bf-asm_2map_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>map.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="mask__counter_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>mask_counter.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="match__source_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>match_source.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="misc_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>misc.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="p4__table_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>p4_table.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="parser-tofino-jbay_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>parser-tofino-jbay.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tofino_2bf-asm_2parser_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>parser.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="bf-asm_2phv_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>phv.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="power__ctl_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>power_ctl.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="register__reference_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>register_reference.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="rvalue__reference__wrapper_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>rvalue_reference_wrapper.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="sections_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>sections.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="slist_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>slist.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="stage_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>stage.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tables_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>tables.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tofino_2bf-asm_2target_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>target.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="top__level_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>top_level.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="ubits_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>ubits.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="backends_2tofino_2bf-asm_2vector_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>vector.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="tofino_2bf-asm_2version_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>version.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="widereg_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>widereg.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h1><a class="anchor" id="documentation"></a>
Documentation</h1>
<h1><a class="anchor" id="setup"></a>
Setup</h1>
<p>The repository contains code for the Barefoot assembler (bfas) and linker (walle). More info on walle can be found in walle/README.md.</p>
<p>Assembler takes assembly files (.bfa or .tfa) as input to generate output json which is then fed to walle to produce binary for tofino.</p>
<h1><a class="anchor" id="dependencies-6"></a>
Dependencies</h1>
<ul>
<li>GNU make</li>
<li>A C++ compiler supporting C++11 (the Makefile uses g++ by defalt)</li>
<li>bison</li>
<li>flex</li>
</ul>
<p>Running the test suite requires access to the Glass p4c_tofino compiler. Running stf tests requires access to the simple test harness. The <code>tests/runtests</code> script will look in various places for these tools (see the top of the script)</p>
<h1><a class="anchor" id="building-assembler"></a>
Building Assembler</h1>
<p>The assenbler is built automatically as part of the full bf-p4c-tofino build; there is currently no supported standalone method of building the assembler by itself.</p>
<h1><a class="anchor" id="address-sanitizer-checks"></a>
Address Sanitizer checks</h1>
<p>(obsolete) To enable address sanitizer checks in the assembler use,</p>
<div class="fragment"><div class="line">user@box$ ./bootstrap.sh --enable-asan-checks</div>
</div><!-- fragment --><p>Or alternatively,</p>
<div class="fragment"><div class="line">user@box$ ./configure --enable-asan-checks</div>
</div><!-- fragment --><p>This configures the Makefile to add -fsanitizer=address &amp; -fsanitizer=undefined. By default the leak sanitizer is also enabled along with the address santizier. You can disable it by setting environment variable ASAN_OPTIONS with "detect\_leaks=0".</p>
<h1><a class="anchor" id="testing-1"></a>
Testing</h1>
<h2><a class="anchor" id="make-targets"></a>
Make Targets</h2>
<div class="fragment"><div class="line">user@box$ make check</div>
</div><!-- fragment --><p>Runs tests/runtests script on all .p4 files in the tests and tests/mau directories and .bfa files in tests/asm directory. This script can run one or more tests specified on the command line, or will run all .p4 files in the current directory if run with no arguments. Stf tests can be run if specified explicitly on the command line; they will not run by default.</p>
<div class="fragment"><div class="line">user@box$ make check-sanity</div>
</div><!-- fragment --><p>This is similar to <code>make check</code> but will only run on .p4 files in the tests directory which is a small subset for a quick sanity check.</p>
<h2><a class="anchor" id="runtests-script"></a>
Runtests Script</h2>
<p>The ./tests/runtests script will first run glass compiler (p4c-tofino) on input .p4 file and then run the assembler (bfas) on generated assembly (.tfa) file. Glass also generates output json which is then compared (by the script) to the json generated from assembler.</p>
<p>To skip running glass use -f option on the runtests script</p>
<p>Use -j </p>
<p>to run parallel threads. If invoking through Make targets set MAKEFLAGS to "-j &lt;value&gt;"</p>
<h2><a class="anchor" id="expected-failures"></a>
Expected Failures</h2>
<p>expected_failures.txt files are under tests &amp; tests/mau directory which outline failing tests with cause (compile, bfas, mismatch). These files must be updated to reflect any new or fixed fails.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">FAIL   </th><th class="markdownTableHeadNone">TYPE   </th><th class="markdownTableHeadNone">CAUSE    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">compile   </td><td class="markdownTableBodyNone">Glass   </td><td class="markdownTableBodyNone">Glass cannot compile input .p4 file    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">bfas   </td><td class="markdownTableBodyNone">Assembler   </td><td class="markdownTableBodyNone">Assembler error while running input assembly file (.bfa)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mismatch   </td><td class="markdownTableBodyNone">Json output   </td><td class="markdownTableBodyNone">Difference in json outputs for glass and assembler   </td></tr>
</table>
<h2><a class="anchor" id="context-json-ignore"></a>
Context Json Ignore</h2>
<p>Context Json output from Glass compiler is verbose and may or may not be consumed entirely by the drivers unlike the assembler Json output. The tests/runtests script ignores the keys placed in the tests/ctxt_json_ignore file while creating json diff to only display relevant mismatches</p>
<h2><a class="anchor" id="json-diff"></a>
Json Diff</h2>
<p>Each test after running will have its own &lt;testname&gt;.out dir with following items: E.g. TEST = exact_match0.p4 exact_match0.p4.out </p>
<h4><a class="anchor" id="glass-json-output"></a>
Glass Json output</h4>
<div class="fragment"><div class="line">├── cfg</div>
<div class="line">│   ├── memories.all.parser.egress.cfg.json.gz</div>
<div class="line">│   ├── memories.all.parser.ingress.cfg.json.gz</div>
<div class="line">│   ├── memories.pipe.cfg.json.gz</div>
<div class="line">│   ├── memories.top.cfg.json.gz</div>
<div class="line">│   ├── regs.all.deparser.header_phase.cfg.json.gz</div>
<div class="line">│   ├── regs.all.deparser.input_phase.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parse_merge.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parser.egress.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parser.ingress.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.00.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.01.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.02.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.03.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.04.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.05.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.06.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.07.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.08.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.09.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.0a.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.0b.cfg.json.gz</div>
<div class="line">│   ├── regs.pipe.cfg.json.gz</div>
<div class="line">│   └── regs.top.cfg.json.gz</div>
<div class="line">├── context</div>
<div class="line">│   ├── deparser.context.json</div>
<div class="line">│   ├── mau.context.json</div>
<div class="line">│   ├── parser.context.json</div>
<div class="line">│   └── phv.context.json</div>
</div><!-- fragment --> <h4><a class="anchor" id="assembler-output-directory"></a>
Assembler Output Directory</h4>
<div class="fragment"><div class="line">├── exact_match0.out</div>
</div><!-- fragment --> <h4><a class="anchor" id="assembler-json-output"></a>
Assembler Json Output</h4>
<div class="fragment"><div class="line">│   ├── memories.all.parser.egress.cfg.json.gz</div>
<div class="line">│   ├── memories.all.parser.ingress.cfg.json.gz</div>
<div class="line">│   ├── memories.pipe.cfg.json.gz</div>
<div class="line">│   ├── memories.top.cfg.json.gz</div>
<div class="line">│   ├── regs.all.deparser.header_phase.cfg.json.gz</div>
<div class="line">│   ├── regs.all.deparser.input_phase.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parse_merge.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parser.egress.cfg.json.gz</div>
<div class="line">│   ├── regs.all.parser.ingress.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.00.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.01.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.02.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.03.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.04.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.05.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.06.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.07.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.08.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.09.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.0a.cfg.json.gz</div>
<div class="line">│   ├── regs.match_action_stage.0b.cfg.json.gz</div>
<div class="line">│   ├── regs.pipe.cfg.json.gz</div>
<div class="line">│   ├── regs.top.cfg.json.gz</div>
</div><!-- fragment --> <h4><a class="anchor" id="context-json"></a>
Context Json</h4>
<div class="fragment"><div class="line">│   └── context.json</div>
</div><!-- fragment --> <h4><a class="anchor" id="symlink-to-glass-assembly-file"></a>
Symlink to Glass Assembly File</h4>
<div class="fragment"><div class="line">├── exact_match0.tfa -&gt; out.tfa</div>
</div><!-- fragment --> <h4><a class="anchor" id="glass-run-log"></a>
Glass Run Log</h4>
<div class="fragment"><div class="line">├── glsc.log</div>
</div><!-- fragment --> <h4><a class="anchor" id="json-diff-file"></a>
Json Diff File</h4>
<div class="fragment"><div class="line">├── json_diff.txt</div>
</div><!-- fragment --> <h4><a class="anchor" id="glass-output-logs"></a>
Glass Output Logs</h4>
<div class="fragment"><div class="line">├── logs</div>
<div class="line">│   ├── asm.log</div>
<div class="line">│   ├── mau.characterize.log</div>
<div class="line">│   ├── mau.config.log</div>
<div class="line">│   ├── mau.gateway.log</div>
<div class="line">│   ├── mau.gw.log</div>
<div class="line">│   ├── mau.log</div>
<div class="line">│   ├── mau.power.log</div>
<div class="line">│   ├── mau.resources.log</div>
<div class="line">│   ├── mau.rf.log</div>
<div class="line">│   ├── mau.sram.log</div>
<div class="line">│   ├── mau.tcam.log</div>
<div class="line">│   ├── mau.tp.log</div>
<div class="line">│   ├── pa.characterize.log</div>
<div class="line">│   ├── pa.liveness.log</div>
<div class="line">│   ├── pa.log</div>
<div class="line">│   ├── parde.calcfields.log</div>
<div class="line">│   ├── parde.config.log</div>
<div class="line">│   ├── parde.error.log</div>
<div class="line">│   ├── parde.log</div>
<div class="line">│   ├── pa.results.log</div>
<div class="line">│   ├── parser.characterize.log</div>
<div class="line">│   └── transform.log</div>
<div class="line">├── name_lookup.c</div>
</div><!-- fragment --> <h4><a class="anchor" id="glass-output-assembly-file"></a>
Glass output assembly file</h4>
<div class="fragment"><div class="line">├── out.tfa</div>
</div><!-- fragment --> <h4><a class="anchor" id="assembler-run-log"></a>
Assembler Run Log</h4>
<div class="fragment"><div class="line">├── bfas.config.log</div>
<div class="line">├── bfas.log</div>
</div><!-- fragment --> <h4><a class="anchor" id="test-visualization-htmls"></a>
Test visualization htmls</h4>
<div class="fragment"><div class="line">└── visualization</div>
<div class="line">    ├── deparser.html</div>
<div class="line">    ├── jquery.js</div>
<div class="line">    ├── mau.html</div>
<div class="line">    ├── parser.egress.html</div>
<div class="line">    ├── parser.ingress.html</div>
<div class="line">    ├── phv_allocation.html</div>
<div class="line">    └── table_placement.html</div>
</div><!-- fragment --><h1><a class="anchor" id="backends-tofinojbay"></a>
Backends (Tofino/JBay)</h1>
<p>Assembler currently supports Tofino backend but code is generic enough to be ported to a different backend like JBay. Architecture specific constants must be parameterized and placed in the constants.h file</p>
<p>"tofino" and "jbay" directories hold the chip schema to be used by the assembler. The chip schema contains register information and is a binary (python pickle file) generated from csv file in bfnregs repository.</p>
<h2><a class="anchor" id="extracting-information-from-hardware-bfnregs-info"></a>
Extracting information from hardware bfnregs info</h2>
<p>To the greatest extent possible, we automatically generate assembler support code directly from the information provided to use by the hardware team. The main 'source' we get from hardware are the Semfore .csr files and the associated .csv files generated by Semafore from the .csr files. We use walle (walle subdirectory) to read the .csv files and distill them into a chip.schema &ndash; a python pickle file containing the datastructures defined in walle/csr.py that encapsulate the information and structure of all the hardware registers.</p>
<p>We then use walle to generate C++ code embodying the register structure, defining C++ classes containing the structure of all the registers. The template.yaml file defines various options for the structure of the resulting C++ code &ndash; which registers to use as the 'roots' of class hierarchies, what files to write the code in, which methods to define in each class. Within the templates.yaml file, there's a <code>global:</code> section giving global options for all files, a <code>generate:</code> section listing the files to generate, and an <code>ignore:</code> section listing register subtrees to ignore (no code will be generated for them &ndash; its as if they don't exist).</p>
<p>Options that can be used include:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">option   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">decl   </td><td class="markdownTableBodyNone">generate just declarations (suitable for a header file)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">defn   </td><td class="markdownTableBodyNone">generate definitions for those declarations. With neither <code>decl</code> or <code>defn</code> will generate complete classes with inline methods    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">checked_array   </td><td class="markdownTableBodyNone">Use the checked_array class (<code>checked_array.h</code>) for arrays (default)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">delete_copy   </td><td class="markdownTableBodyNone">Delete copy constructors for generated classes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dump_unread   </td><td class="markdownTableBodyNone">generate a <code>dump_unread</code> method which dumps all unread registers to an ostream (default False)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">emit_binary   </td><td class="markdownTableBodyNone">generate an <code>emit_binary</code> method that outputs binary code for the driver/model    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">emit_fieldname   </td><td class="markdownTableBodyNone">generate <code>emit_fieldname</code> method used to print logging messages    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">emit_json   </td><td class="markdownTableBodyNone">generate <code>emit_json</code> method to generate config json    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">enable_disable   </td><td class="markdownTableBodyNone">generate <code>enable</code>, <code>disable</code>, and <code>modified</code> methods    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">global   </td><td class="markdownTableBodyNone">generate the specified register types once as global names rather than as nested in the containing object(s)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">include   </td><td class="markdownTableBodyNone">generate a <code>#include</code> of the specified file    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name   </td><td class="markdownTableBodyNone">Change the name of the top-level object    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">namespace   </td><td class="markdownTableBodyNone">Put all declarations in the specified namesapce    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">unpack_json   </td><td class="markdownTableBodyNone">generate <code>unpack_json</code> method    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">widereg   </td><td class="markdownTableBodyNone">Use <code>widereg</code> for registers wider than 64 bits    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">write_dma   </td><td class="markdownTableBodyNone">Generate &lsquo;'B&rsquo;<code>block writes for the specified registers instead of</code>'R'<code>single register writes in</code>emit_binary` methods   </td></tr>
</table>
<p>This results in C++ code that can either generate .cfg.json files or binary files for use by the driver/model. When cfg.json files are produced, walle can be used to link them into a binary file. There are also options for generating C++ code to read .cfg.json files for future support of binary disassembly.</p>
<h2><a class="anchor" id="config-json"></a>
Config JSON</h2>
<p>The config json files (with .cfg.json extension) are generated by the assembler which are fed into walle to generate the binary (also called <code>tofino.bin</code>)</p>
<p>The config json is nothing but json files with a map of all the registers for a backend. In order to limit the json file size assembler disables registers which are not set (with the -C or condense json flag). Some registers are also explicitly disabled or enabled based on what the drive expects to see in the tofino.bin. Below is the status of regs and whether they will appear in the config json. </p><div class="fragment"><div class="line">---------------------------------</div>
<div class="line">Disabled - (unconditionally)</div>
<div class="line">---------------------------------</div>
<div class="line">mem_pipe.mau</div>
<div class="line">regs.input.icr.inp_cfg</div>
<div class="line">regs.input.icr.intr</div>
<div class="line">regs.header.hem.he_edf_cfg</div>
<div class="line">regs.header.him.hi_edf_cfg</div>
<div class="line">regs.glb_group</div>
<div class="line">regs.chan0_group.chnl_drop</div>
<div class="line">regs.chan0_group.chnl_metadata_fix</div>
<div class="line">regs.chan1_group.chnl_drop</div>
<div class="line">regs.chan1_group.chnl_metadata_fix</div>
<div class="line">regs.chan2_group.chnl_drop</div>
<div class="line">regs.chan2_group.chnl_metadata_fix</div>
<div class="line">regs.chan3_group.chnl_drop</div>
<div class="line">regs.chan3_group.chnl_metadata_fix</div>
<div class="line">---------------------------------</div>
<div class="line">Disabled - (if Zero)</div>
<div class="line">---------------------------------</div>
<div class="line">regs (In all regs)</div>
<div class="line">mem_top (mau)</div>
<div class="line">mem_pipe (mau/dummy_reg)</div>
<div class="line">reg_top (ethgpiobr, ethgpiotl, pipes)</div>
<div class="line">reg_pipe (mau, pmarb, deparser)</div>
<div class="line">---------------------------------</div>
<div class="line">Enabled - (always)</div>
<div class="line">---------------------------------</div>
<div class="line">regs.dp.imem.imem_subword8</div>
<div class="line">regs.dp.imem.imem_subword16</div>
<div class="line">regs.dp.imem.imem_subword32</div>
<div class="line">regs.rams.map_alu.row[row].adrmux.mapram_config[col]</div>
</div><!-- fragment --><p> Once JBay support is added for all regs, above will be different for both backends.</p>
<p>Driver dictates which regs are disabled or enabled unconditionally. Other regs which are disabled if zero are to limit file size and driver should automatically fill in the zero values.</p>
<h3><a class="anchor" id="generating-and-using-chipschema"></a>
Generating and using chip.schema</h3>
<p>chip.schema files are generated by walle from the csv files in the bfnregs repo. To generate a new chip.schema file, use </p><pre class="fragment">walle/walle.py --generate-schema ${BFNREGS_REPO}/modules/${CHIP}_regs
</pre><p>where <code>${BFNREGS_REPO}</code> is the root of the bfnregs repo, and <code>${CHIP}</code> is the chip to target (<code>tofino</code>, <code>trestles</code>, or <code>jbay</code> at the moment). The newly created chip.schema file should then be moved into the jbay or tofino subdirectory where the build system expects to find it.</p>
<p>chip.schema is a binary (python pickle) file; you can use <code>walle.py --dump-schema</code> to dump it as (vaguely human readble) yaml. It is basically a DAG of python objects (csr.address_map, csr.address_map_instance, and csr.reg) describing the register tree. The build uses walle to turn this into json files describing various subtrees of the dag. The <code>template_objectss.yaml</code> file describes which subtrees to generate json files for as well as list of subtrees to ignore (elide from the json files). Names in this file are the names of csr.address_map objects (NOT instances), and where the generated files are nested, the containing json will contain a reference to the contained json rather than a copy of the tree. In this way, the generated json files as a group describe the DAG even though json can only describe trees, not DAGs.</p>
<p>If, when running make, you get a KeyError from walle, that generally means that the template_objects.yaml file contains a refernce to some csr.address_map that does not exist in the chip.schema file &ndash; the register tree has changed in a way that invalidates the json files it is trying to generate. If you have your python setup to drop into pydb automatically on an uncaught exception (highly recommended), at that point you can use <code>pp section</code> to list all the csr.address_map objects that <em>are</em> in the chip.schema. Generally you'll find that it is the 'ignore' names that have changed, so fixing them is trivial.</p>
<h1><a class="anchor" id="assembly-syntax"></a>
Assembly Syntax</h1>
<p>The assembly syntax is documented in <code>SYNTAX.md</code> file </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dec21994cd756836ecefab773235960a.html">backends</a></li><li class="navelem"><a class="el" href="dir_c4ded715df726299fc9cd18b15628924.html">tofino</a></li><li class="navelem"><a class="el" href="dir_e3e152015c473544e5818afd3f21296d.html">bf-asm</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
