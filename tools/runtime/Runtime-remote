#!/usr/bin/env python
#
# Autogenerated by Thrift Compiler (0.9.1)
#
# DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
#
#  options string: py
#

import sys
import pprint
from urlparse import urlparse
from thrift.transport import TTransport
from thrift.transport import TSocket
from thrift.transport import THttpClient
from thrift.protocol import TBinaryProtocol

from runtime import Runtime
from runtime.ttypes import *

if len(sys.argv) <= 1 or sys.argv[1] == '--help':
  print ''
  print 'Usage: ' + sys.argv[0] + ' [-h host[:port]] [-u url] [-f[ramed]] function [arg1 [arg2...]]'
  print ''
  print 'Functions:'
  print '  BmEntryHandle bm_table_add_exact_match_entry(string table_name, string action_name, BmMatchKey match_key, BmActionData action_data)'
  print '  BmEntryHandle bm_table_add_lpm_entry(string table_name, string action_name, BmMatchKey match_key, i32 prefix_length, BmActionData action_data)'
  print '  BmEntryHandle bm_table_add_ternary_match_entry(string table_name, string action_name, BmMatchKey match_key, BmMatchKey match_mask, i32 priority, BmActionData action_data)'
  print '  void bm_set_default_action(string table_name, string action_name, BmActionData action_data)'
  print '  void bm_table_delete_entry(string table_name, BmEntryHandle entry_handle)'
  print ''
  sys.exit(0)

pp = pprint.PrettyPrinter(indent = 2)
host = 'localhost'
port = 9090
uri = ''
framed = False
http = False
argi = 1

if sys.argv[argi] == '-h':
  parts = sys.argv[argi+1].split(':')
  host = parts[0]
  if len(parts) > 1:
    port = int(parts[1])
  argi += 2

if sys.argv[argi] == '-u':
  url = urlparse(sys.argv[argi+1])
  parts = url[1].split(':')
  host = parts[0]
  if len(parts) > 1:
    port = int(parts[1])
  else:
    port = 80
  uri = url[2]
  if url[4]:
    uri += '?%s' % url[4]
  http = True
  argi += 2

if sys.argv[argi] == '-f' or sys.argv[argi] == '-framed':
  framed = True
  argi += 1

cmd = sys.argv[argi]
args = sys.argv[argi+1:]

if http:
  transport = THttpClient.THttpClient(host, port, uri)
else:
  socket = TSocket.TSocket(host, port)
  if framed:
    transport = TTransport.TFramedTransport(socket)
  else:
    transport = TTransport.TBufferedTransport(socket)
protocol = TBinaryProtocol.TBinaryProtocol(transport)
client = Runtime.Client(protocol)
transport.open()

if cmd == 'bm_table_add_exact_match_entry':
  if len(args) != 4:
    print 'bm_table_add_exact_match_entry requires 4 args'
    sys.exit(1)
  pp.pprint(client.bm_table_add_exact_match_entry(args[0],args[1],eval(args[2]),eval(args[3]),))

elif cmd == 'bm_table_add_lpm_entry':
  if len(args) != 5:
    print 'bm_table_add_lpm_entry requires 5 args'
    sys.exit(1)
  pp.pprint(client.bm_table_add_lpm_entry(args[0],args[1],eval(args[2]),eval(args[3]),eval(args[4]),))

elif cmd == 'bm_table_add_ternary_match_entry':
  if len(args) != 6:
    print 'bm_table_add_ternary_match_entry requires 6 args'
    sys.exit(1)
  pp.pprint(client.bm_table_add_ternary_match_entry(args[0],args[1],eval(args[2]),eval(args[3]),eval(args[4]),eval(args[5]),))

elif cmd == 'bm_set_default_action':
  if len(args) != 3:
    print 'bm_set_default_action requires 3 args'
    sys.exit(1)
  pp.pprint(client.bm_set_default_action(args[0],args[1],eval(args[2]),))

elif cmd == 'bm_table_delete_entry':
  if len(args) != 2:
    print 'bm_table_delete_entry requires 2 args'
    sys.exit(1)
  pp.pprint(client.bm_table_delete_entry(args[0],eval(args[1]),))

else:
  print 'Unrecognized method %s' % cmd
  sys.exit(1)

transport.close()
